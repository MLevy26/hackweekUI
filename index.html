<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Content Compass</title>
    <style>
        /* Previous styles remain the same until result-actions */
        
        .result-actions {
            margin-top: 16px;
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .save-button, .export-button {
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
        }

        .save-button {
            background-color: #10B981;
            color: white;
        }

        .save-button:hover {
            background-color: #059669;
            transform: translateY(-1px);
        }

        .export-button {
            background-color: #6B7280;
            color: white;
        }

        .export-button:hover {
            background-color: #4B5563;
            transform: translateY(-1px);
        }

        .save-status {
            font-size: 14px;
            color: #10B981;
            margin-left: 8px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .save-status.visible {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="post-form-container">
        <h2>Content Compass</h2>
        <div class="form-group">
            <label>Select the Content Database*</label>
            <select class="form-control" id="postType">
                <option value="" disabled selected>Select Database</option>
                <option value="square-help">Square Help</option>
                <option value="squarewise">Google Drive</option>
                <option value="high-spot">High Spot</option>
            </select>
        </div>

        <!-- Google Drive Section -->
        <div id="googleDriveSection" class="hidden">
            <div class="form-group">
                <label>Search Your Topic</label>
                <input type="text" class="form-control" id="searchTopicDrive" placeholder="Enter your search topic">
                <button class="search-button" id="searchButtonDrive">Search</button>
            </div>
            <div id="searchResultsDrive" class="search-results">
                <!-- Search results will be displayed here -->
            </div>
        </div>

        <!-- Square Help Section -->
        <div id="squareHelpSection" class="hidden">
            <div class="form-group">
                <label>Search Your Topic</label>
                <input type="text" class="form-control" id="searchTopicSquare" placeholder="Enter your search topic">
                <button class="search-button" id="searchButtonSquare">Search</button>
            </div>
            <div id="searchResultsSquare" class="search-results">
                <!-- Search results will be displayed here -->
            </div>
        </div>

        <!-- High Spot Section -->
        <div id="highSpotSection" class="hidden">
            <div class="form-group">
                <label>Search Your Topic</label>
                <input type="text" class="form-control" id="searchTopicHighSpot" placeholder="Enter your search topic">
                <button class="search-button" id="searchButtonHighSpot">Search</button>
            </div>
            <div id="searchResultsHighSpot" class="search-results">
                <!-- Search results will be displayed here -->
            </div>
        </div>
    </div>

    <script>
        // Square Help content data remains the same
        const squareHelpContent = {
            articles: [
                {
                    title: "Overview of Square Risk Manager",
                    content: "Square Risk Manager helps you monitor and manage suspicious activity in your Square account. With Risk Manager, you can view flagged payments, customize your risk settings, and manage your payment risk. Risk Manager provides tools like Address Verification System (AVS) and Card Verification Value (CVV) to help prevent fraudulent transactions.",
                    type: "section"
                },
                // ... other articles remain the same ...
            ]
        };

        // Function to save content changes
        function saveContent(sectionTitle) {
            const contentDiv = document.querySelector(`.editable-content[data-section="${sectionTitle}"]`);
            const saveStatus = document.getElementById(`save-status-${sectionTitle.replace(/\s+/g, '-')}`);
            
            if (contentDiv) {
                const articleIndex = squareHelpContent.articles.findIndex(a => a.title === sectionTitle);
                if (articleIndex !== -1) {
                    // Save the plain text content (without highlights)
                    squareHelpContent.articles[articleIndex].content = contentDiv.innerText;
                    
                    // Show save status
                    saveStatus.classList.add('visible');
                    setTimeout(() => {
                        saveStatus.classList.remove('visible');
                    }, 2000);
                }
            }
        }

        // Function to export content to text file
        function exportContent(sectionTitle) {
            const contentDiv = document.querySelector(`.editable-content[data-section="${sectionTitle}"]`);
            
            if (contentDiv) {
                const content = contentDiv.innerText; // Get plain text without HTML
                const blob = new Blob([content], { type: 'text/plain' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${sectionTitle.toLowerCase().replace(/\s+/g, '-')}.txt`;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
            }
        }

        // Function to handle search for Square Help
        function handleSquareHelpSearch(searchQuery, resultsDiv) {
            if (!searchQuery) {
                resultsDiv.innerHTML = '<div class="error-message">Please enter a search term</div>';
                return;
            }

            // Show loading state
            resultsDiv.innerHTML = '<div class="loading">Searching...</div>';

            // Perform search
            const searchTerms = searchQuery.toLowerCase().split(' ').filter(term => term.length > 0);
            const searchResults = [];

            squareHelpContent.articles.forEach(article => {
                // Check if all search terms appear in the content
                const matches = searchTerms.every(term => 
                    article.content.toLowerCase().includes(term)
                );

                if (matches) {
                    searchResults.push({
                        title: article.title,
                        fullContent: article.content,
                        type: article.type
                    });
                }
            });

            if (searchResults.length > 0) {
                const resultsHTML = `
                    <h3>Search Results from Square Risk Manager Guide</h3>
                    <div class="search-summary">Found ${searchResults.length} matching section${searchResults.length === 1 ? '' : 's'}</div>
                    <div style="max-height: 600px; overflow-y: auto;">
                        ${searchResults.map(result => {
                            let highlightedContent = result.fullContent;
                            // Highlight each search term
                            searchTerms.forEach(term => {
                                const regex = new RegExp(`(${term})`, 'gi');
                                highlightedContent = highlightedContent.replace(regex, '<span class="search-term-highlight">$1</span>');
                            });
                            
                            const safeSectionId = result.title.replace(/[^a-zA-Z0-9]/g, '-');
                            
                            return `
                                <div class="result-item">
                                    <div class="result-section">${result.title}</div>
                                    <div class="result-content-wrapper">
                                        <div class="editable-content" contenteditable="true" data-section="${result.title}">${highlightedContent}</div>
                                    </div>
                                    <div class="result-type">${result.type}</div>
                                    <div class="result-actions">
                                        <button class="save-button" onclick="saveContent('${result.title}')">Save Changes</button>
                                        <button class="export-button" onclick="exportContent('${result.title}')">Export to Text</button>
                                        <span class="save-status" id="save-status-${safeSectionId}">Changes saved!</span>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
                resultsDiv.innerHTML = resultsHTML;

                // Add event listeners for content changes
                document.querySelectorAll('.editable-content').forEach(div => {
                    div.addEventListener('input', () => {
                        const title = div.dataset.section;
                        const articleIndex = squareHelpContent.articles.findIndex(a => a.title === title);
                        if (articleIndex !== -1) {
                            squareHelpContent.articles[articleIndex].content = div.innerText;
                            
                            // Re-apply highlighting
                            let content = div.innerText;
                            searchTerms.forEach(term => {
                                const regex = new RegExp(`(${term})`, 'gi');
                                content = content.replace(regex, '<span class="search-term-highlight">$1</span>');
                            });
                            div.innerHTML = content;
                        }
                    });
                });
            } else {
                resultsDiv.innerHTML = '<div class="no-results">No matching content found in the Square Risk Manager guide.</div>';
            }
        }

        // Rest of the code (event listeners, etc.) remains the same
        document.getElementById('postType').addEventListener('change', function() {
            const googleDriveSection = document.getElementById('googleDriveSection');
            const squareHelpSection = document.getElementById('squareHelpSection');
            const highSpotSection = document.getElementById('highSpotSection');
            
            // Hide all sections first
            googleDriveSection.classList.add('hidden');
            squareHelpSection.classList.add('hidden');
            highSpotSection.classList.add('hidden');
            
            // Show the selected section
            switch(this.value) {
                case 'squarewise':
                    googleDriveSection.classList.remove('hidden');
                    break;
                case 'square-help':
                    squareHelpSection.classList.remove('hidden');
                    break;
                case 'high-spot':
                    highSpotSection.classList.remove('hidden');
                    break;
            }
        });

        // Add search button functionality for Google Drive
        document.getElementById('searchButtonDrive').addEventListener('click', () => {
            handleSearch('searchTopicDrive', 'searchResultsDrive', 'http://localhost:5000/googledrive/search');
        });

        // Add search button functionality for Square Help
        document.getElementById('searchButtonSquare').addEventListener('click', () => {
            const searchQuery = document.getElementById('searchTopicSquare').value.trim();
            const resultsDiv = document.getElementById('searchResultsSquare');
            handleSquareHelpSearch(searchQuery, resultsDiv);
        });

        // Add search button functionality for High Spot
        document.getElementById('searchButtonHighSpot').addEventListener('click', () => {
            handleSearch('searchTopicHighSpot', 'searchResultsHighSpot', 'http://localhost:5000/highspot/search');
        });
    </script>
</body>
</html>
