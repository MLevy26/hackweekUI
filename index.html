<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compare Content</title>
    <style>
        .hidden {
            display: none;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background-color: #F8F9FA;
            margin: 0;
            padding: 20px;
        }

        .post-form-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        h2, h3 {
            font-size: 24px;
            font-weight: 500;
            margin-bottom: 24px;
            color: #1F1F1F;
        }

        h3 {
            font-size: 20px;
            margin-top: 20px;
        }

        .form-group {
            margin-bottom: 24px;
            padding-bottom: 24px;
            border-bottom: 1px solid #E0E0E0;
        }

        .form-group:last-child {
            border-bottom: none;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            color: #1F1F1F;
        }

        .form-control {
            width: 100%;
            padding: 8px 12px;
            font-size: 14px;
            border: 1px solid #E0E0E0;
            border-radius: 4px;
            background-color: #FFFFFF;
            box-sizing: border-box;
        }

        select.form-control {
            appearance: none;
            background-image: url('data:image/svg+xml;utf8,<svg fill="%23666" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>');
            background-repeat: no-repeat;
            background-position: right 8px center;
            padding-right: 32px;
        }

        .search-button {
            background-color: #0070BA;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
            margin-top: 10px;
            transition: background-color 0.2s;
        }

        .search-button:hover {
            background-color: #005ea2;
        }

        .search-results {
            margin-top: 20px;
        }

        .result-item {
            padding: 16px;
            border: 1px solid #E0E0E0;
            border-radius: 4px;
            margin-bottom: 16px;
            background-color: #FFFFFF;
        }

        .result-item:hover {
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .result-section {
            font-weight: 500;
            color: #1F1F1F;
            margin-bottom: 12px;
            font-size: 16px;
            padding-bottom: 8px;
            border-bottom: 1px solid #E0E0E0;
        }

        .result-content-wrapper {
            position: relative;
            margin: 8px 0;
        }

        .editable-content {
            width: 100%;
            min-height: 120px;
            padding: 12px;
            font-size: 14px;
            line-height: 1.6;
            border: 1px solid #E0E0E0;
            border-radius: 4px;
            background-color: #FFFFFF;
            resize: vertical;
            font-family: inherit;
            margin-bottom: 8px;
        }

        .editable-content:focus {
            outline: none;
            border-color: #0070BA;
            box-shadow: 0 0 0 2px rgba(0,112,186,0.2);
        }

        .highlighted-content {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            padding: 12px;
            font-size: 14px;
            line-height: 1.6;
            pointer-events: none;
            white-space: pre-wrap;
            overflow: hidden;
        }

        .highlight {
            background-color: #fff3cd;
            border-radius: 2px;
        }

        .result-type {
            font-size: 12px;
            color: #666;
            margin-top: 8px;
        }

        .error-message {
            color: #dc3545;
            padding: 10px;
            margin-top: 10px;
            border-radius: 4px;
            background-color: #f8d7da;
        }

        .loading {
            color: #666;
            padding: 10px;
            text-align: center;
        }

        .no-results {
            color: #666;
            padding: 20px;
            text-align: center;
            background-color: #f8f9fa;
            border-radius: 4px;
            margin-top: 16px;
        }

        .search-summary {
            color: #666;
            font-size: 14px;
            margin: 8px 0 16px;
            padding: 12px;
            background-color: #f8f9fa;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="post-form-container">
        <h2>Compare Content</h2>
        <div class="form-group">
            <label>Select the Content Database*</label>
            <select class="form-control" id="postType">
                <option value="" disabled selected>Select Database</option>
                <option value="square-help">Square Help</option>
                <option value="squarewise">Google Drive</option>
                <option value="high-spot">High Spot</option>
            </select>
        </div>

        <!-- Google Drive Section -->
        <div id="googleDriveSection" class="hidden">
            <div class="form-group">
                <label>Search Your Topic</label>
                <input type="text" class="form-control" id="searchTopicDrive" placeholder="Enter your search topic">
                <button class="search-button" id="searchButtonDrive">Search</button>
            </div>
            <div id="searchResultsDrive" class="search-results">
                <!-- Search results will be displayed here -->
            </div>
        </div>

        <!-- Square Help Section -->
        <div id="squareHelpSection" class="hidden">
            <div class="form-group">
                <label>Search Your Topic</label>
                <input type="text" class="form-control" id="searchTopicSquare" placeholder="Enter your search topic">
                <button class="search-button" id="searchButtonSquare">Search</button>
            </div>
            <div id="searchResultsSquare" class="search-results">
                <!-- Search results will be displayed here -->
            </div>
        </div>

        <!-- High Spot Section -->
        <div id="highSpotSection" class="hidden">
            <div class="form-group">
                <label>Search Your Topic</label>
                <input type="text" class="form-control" id="searchTopicHighSpot" placeholder="Enter your search topic">
                <button class="search-button" id="searchButtonHighSpot">Search</button>
            </div>
            <div id="searchResultsHighSpot" class="search-results">
                <!-- Search results will be displayed here -->
            </div>
        </div>
    </div>

    <script>
        // Square Help content data
        const squareHelpContent = {
            articles: [
                {
                    title: "Overview of Square Risk Manager",
                    content: "Square Risk Manager helps you monitor and manage suspicious activity in your Square account. With Risk Manager, you can view flagged payments, customize your risk settings, and manage your payment risk. Risk Manager provides tools like Address Verification System (AVS) and Card Verification Value (CVV) to help prevent fraudulent transactions.",
                    type: "section"
                },
                {
                    title: "Access Risk Manager",
                    content: "To access Risk Manager: 1. Sign in to your Square Dashboard. 2. Go to Risk Manager in your online Square Dashboard. Note: Risk Manager access is limited to the Account Owner and users with appropriate permissions.",
                    type: "section"
                },
                {
                    title: "View Flagged Payments",
                    content: "In Risk Manager, you can view payments that have been flagged as potentially risky: 1. Go to the Flagged Payments tab 2. View payment details including amount, date, and risk factors 3. Take action on flagged payments. The system uses Address Verification System (AVS) results to help identify suspicious transactions.",
                    type: "section"
                },
                {
                    title: "Customize Risk Settings",
                    content: "Adjust your risk settings to match your business needs: 1. Go to the Settings tab 2. Configure risk rules and thresholds 3. Set up notification preferences for flagged payments 4. Configure Address Verification System (AVS) settings 5. Set CVV verification requirements",
                    type: "section"
                },
                {
                    title: "Risk Factors",
                    content: "Risk Manager evaluates various factors including: - Unusual payment patterns - High-risk payment methods - Suspicious customer behavior - Geographic location - Transaction amount variations - Address Verification System (AVS) mismatches - CVV verification failures - IP address location mismatches",
                    type: "section"
                },
                {
                    title: "Security Features",
                    content: "Square Risk Manager includes several security features: 1. Address Verification System (AVS) checks billing address accuracy 2. Card Verification Value (CVV) validates card possession 3. IP geolocation tracking identifies location mismatches 4. Machine learning algorithms detect unusual patterns",
                    type: "section"
                },
                {
                    title: "Managing Flagged Payments",
                    content: "When a payment is flagged: 1. Review the payment details and risk factors 2. Check Address Verification System (AVS) results 3. Verify CVV status 4. Decide whether to accept or decline the payment 5. Document your decision for future reference",
                    type: "section"
                },
                {
                    title: "Risk Reports",
                    content: "Generate and view risk reports: 1. Go to the Reports tab 2. Select your desired date range 3. View risk trends and patterns 4. Export reports for further analysis 5. Review Address Verification System (AVS) statistics",
                    type: "section"
                },
                {
                    title: "Understanding AVS",
                    content: "The Address Verification System (AVS) is a fraud prevention system that verifies the billing address provided by the customer matches the address on file with their credit card issuer. AVS helps prevent unauthorized card usage and reduces chargebacks. When AVS detects a mismatch, the transaction is flagged for review.",
                    type: "section"
                }
            ]
        };

        document.getElementById('postType').addEventListener('change', function() {
            const googleDriveSection = document.getElementById('googleDriveSection');
            const squareHelpSection = document.getElementById('squareHelpSection');
            const highSpotSection = document.getElementById('highSpotSection');
            
            // Hide all sections first
            googleDriveSection.classList.add('hidden');
            squareHelpSection.classList.add('hidden');
            highSpotSection.classList.add('hidden');
            
            // Show the selected section
            switch(this.value) {
                case 'squarewise':
                    googleDriveSection.classList.remove('hidden');
                    break;
                case 'square-help':
                    squareHelpSection.classList.remove('hidden');
                    break;
                case 'high-spot':
                    highSpotSection.classList.remove('hidden');
                    break;
            }
        });

        // Function to handle search for Square Help
        function handleSquareHelpSearch(searchQuery, resultsDiv) {
            if (!searchQuery) {
                resultsDiv.innerHTML = '<div class="error-message">Please enter a search term</div>';
                return;
            }

            // Show loading state
            resultsDiv.innerHTML = '<div class="loading">Searching...</div>';

            // Perform search
            const searchTerms = searchQuery.toLowerCase().split(' ').filter(term => term.length > 0);
            const searchResults = [];

            squareHelpContent.articles.forEach(article => {
                // Check if any search term appears in the content
                const matches = searchTerms.every(term => 
                    article.content.toLowerCase().includes(term)
                );

                if (matches) {
                    searchResults.push({
                        title: article.title,
                        fullContent: article.content,
                        type: article.type
                    });
                }
            });

            if (searchResults.length > 0) {
                const resultsHTML = `
                    <h3>Search Results from Square Risk Manager Guide</h3>
                    <div class="search-summary">Found ${searchResults.length} matching section${searchResults.length === 1 ? '' : 's'}</div>
                    <div style="max-height: 600px; overflow-y: auto;">
                        ${searchResults.map(result => {
                            let highlightedContent = result.fullContent;
                            // Highlight each search term
                            searchTerms.forEach(term => {
                                const regex = new RegExp(`(${term})`, 'gi');
                                highlightedContent = highlightedContent.replace(regex, '<span class="highlight">$1</span>');
                            });
                            
                            return `
                                <div class="result-item">
                                    <div class="result-section">${result.title}</div>
                                    <div class="result-content-wrapper">
                                        <textarea class="editable-content" data-section="${result.title}">${result.fullContent}</textarea>
                                        <div class="highlighted-content">${highlightedContent}</div>
                                    </div>
                                    <div class="result-type">${result.type}</div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
                resultsDiv.innerHTML = resultsHTML;

                // Add event listeners to sync scroll between textarea and highlighted content
                document.querySelectorAll('.editable-content').forEach(textarea => {
                    const highlightedDiv = textarea.nextElementSibling;
                    
                    // Sync scroll positions
                    textarea.addEventListener('scroll', () => {
                        highlightedDiv.scrollTop = textarea.scrollTop;
                        highlightedDiv.scrollLeft = textarea.scrollLeft;
                    });

                    // Update content when edited
                    textarea.addEventListener('input', () => {
                        const title = textarea.dataset.section;
                        const articleIndex = squareHelpContent.articles.findIndex(a => a.title === title);
                        if (articleIndex !== -1) {
                            squareHelpContent.articles[articleIndex].content = textarea.value;
                            
                            // Update highlighted content
                            let highlightedContent = textarea.value;
                            searchTerms.forEach(term => {
                                const regex = new RegExp(`(${term})`, 'gi');
                                highlightedContent = highlightedContent.replace(regex, '<span class="highlight">$1</span>');
                            });
                            highlightedDiv.innerHTML = highlightedContent;
                        }
                    });
                });
            } else {
                resultsDiv.innerHTML = '<div class="no-results">No matching content found in the Square Risk Manager guide.</div>';
            }
        }

        // Function to handle search for other sections
        function handleSearch(searchId, resultsId, apiEndpoint) {
            const searchQuery = document.getElementById(searchId).value.trim();
            const resultsDiv = document.getElementById(resultsId);
            
            if (resultsId === 'searchResultsSquare') {
                handleSquareHelpSearch(searchQuery, resultsDiv);
                return;
            }

            if (!searchQuery) {
                resultsDiv.innerHTML = '<div class="error-message">Please enter a search term</div>';
                return;
            }

            // Show loading state
            resultsDiv.innerHTML = '<div class="loading">Searching...</div>';

            // Send the search query to the backend
            fetch(apiEndpoint, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ query: searchQuery })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Search request failed');
                }
                return response.json();
            })
            .then(data => {
                if (data && data.length > 0) {
                    // Create results HTML
                    const resultsHTML = `
                        <h3>Search Results</h3>
                        <div style="max-height: 400px; overflow-y: auto;">
                            ${data.map(item => `
                                <div class="result-item">
                                    <div class="result-name">${item.name || item.title}</div>
                                    <div class="result-type">
                                        ${item.type || item.mimeType?.replace('application/', '').replace('vnd.google-apps.', '') || ''}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                    resultsDiv.innerHTML = resultsHTML;
                } else {
                    resultsDiv.innerHTML = '<div class="loading">No documents found matching your search.</div>';
                }
            })
            .catch(error => {
                resultsDiv.innerHTML = '<div class="error-message">Error performing search. Please try again.</div>';
                console.error('Search error:', error);
            });
        }

        // Add search button functionality for Google Drive
        document.getElementById('searchButtonDrive').addEventListener('click', () => {
            handleSearch('searchTopicDrive', 'searchResultsDrive', 'http://localhost:5000/googledrive/search');
        });

        // Add search button functionality for Square Help
        document.getElementById('searchButtonSquare').addEventListener('click', () => {
            const searchQuery = document.getElementById('searchTopicSquare').value.trim();
            const resultsDiv = document.getElementById('searchResultsSquare');
            handleSquareHelpSearch(searchQuery, resultsDiv);
        });

        // Add search button functionality for High Spot
        document.getElementById('searchButtonHighSpot').addEventListener('click', () => {
            handleSearch('searchTopicHighSpot', 'searchResultsHighSpot', 'http://localhost:5000/highspot/search');
        });
    </script>
</body>
</html>